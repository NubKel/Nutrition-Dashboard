{"ast":null,"code":"var _jsxFileName = \"/Users/stanyan/Desktop/nutrition-dashboard/src/component/PictureMatch/index.jsx\";\nimport React, { Component } from 'react';\nimport axios from 'axios';\nimport PubSub from 'pubsub-js';\nimport Result from './result';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default class PictureMatch extends Component {\n  constructor() {\n    super(...arguments);\n    this.state = {\n      food: []\n    };\n\n    this.saveFood = food => {\n      this.setState({\n        food\n      });\n    };\n\n    this.search = e => {\n      // PubSub.publish('updateListState',{isFirst:false,isLoading:true})\n      e.preventDefault(); //获取图片文件，图片类型，图片大小\n\n      const file = e.target.files[0];\n      const type = file.type;\n      const size = file.size;\n      const regularType = ['image/png', 'image/jpg', 'image/jpeg']; //图片类型限制\n\n      if (regularType.indexOf(type.toLowerCase()) === -1) {\n        return false;\n      } //图片大小限制\n\n\n      if (size && size > 5242880) {\n        return false;\n      } //图片文件转成base64格式\n\n\n      const reader = new FileReader();\n      reader.readAsDataURL(file);\n\n      reader.onloadend = () => {\n        console.log(reader); //Base64转换成二进制\n\n        const dataURItoBlob = dataURI => {\n          const byteString = atob(dataURI.split(',')[1]);\n          const mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0];\n          const ab = new ArrayBuffer(byteString.length);\n          const ia = new Uint8Array(ab);\n\n          for (let i = 0; i < byteString.length; i++) {\n            ia[i] = byteString.charCodeAt(i);\n          }\n\n          return new Blob([ab], {\n            type: mimeString\n          });\n        };\n\n        const blob = dataURItoBlob(reader.result);\n        const form = new FormData();\n        form.append(\"file\", blob);\n        const options = {\n          method: 'POST',\n          url: 'https://spoonacular-recipe-food-nutrition-v1.p.rapidapi.com/food/images/analyze',\n          headers: {\n            'content-type': 'multipart/form-data; boundary=---011000010111000001101001',\n            'x-rapidapi-host': 'spoonacular-recipe-food-nutrition-v1.p.rapidapi.com',\n            'x-rapidapi-key': 'ca34833afamsh5ac992bc1103a7fp14ff01jsne781a4ca7f2a'\n          },\n          data: form\n        };\n        axios.request(options).then(function (response) {\n          console.log(response.data);\n          this.saveFood(response.data); // PubSub.publish('pictureMatch', {users: response.data})\n          // PubSub.publish('updateListState',{isLoading:false,users:response.data})\n        }).catch(function (error) {\n          console.error(error);\n        });\n      };\n    };\n  }\n\n  render() {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"user-box\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"discount card\",\n          style: {\n            '--delay': '.4s'\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"input\", {\n            className: \"select-img-input\",\n            onChange: e => this.search(e),\n            type: \"file\",\n            name: \"fileSelect\",\n            accept: \"image/*\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 74,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(Result, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 81,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 73,\n          columnNumber: 15\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 72,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 71,\n      columnNumber: 12\n    }, this);\n  }\n\n}","map":{"version":3,"sources":["/Users/stanyan/Desktop/nutrition-dashboard/src/component/PictureMatch/index.jsx"],"names":["React","Component","axios","PubSub","Result","PictureMatch","state","food","saveFood","setState","search","e","preventDefault","file","target","files","type","size","regularType","indexOf","toLowerCase","reader","FileReader","readAsDataURL","onloadend","console","log","dataURItoBlob","dataURI","byteString","atob","split","mimeString","ab","ArrayBuffer","length","ia","Uint8Array","i","charCodeAt","Blob","blob","result","form","FormData","append","options","method","url","headers","data","request","then","response","catch","error","render"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport axios from 'axios';\nimport PubSub from 'pubsub-js';\nimport Result from './result';\n\nexport default class PictureMatch extends Component {\n  state = {food: []}\n\n  saveFood = (food) => {\n    this.setState({food})\n  }\nsearch = (e) =>{\n  \n    // PubSub.publish('updateListState',{isFirst:false,isLoading:true})\n    e.preventDefault()\n//获取图片文件，图片类型，图片大小\n    const file = e.target.files[0]\n    const type = file.type\n    const size = file.size\n    const regularType = ['image/png', 'image/jpg', 'image/jpeg']\n//图片类型限制\n    if (regularType.indexOf(type.toLowerCase()) === -1) {\n    return false\n    }\n//图片大小限制\n    if (size && size > 5242880) {\n    return false\n    }\n//图片文件转成base64格式\n    const reader = new FileReader()\n    reader.readAsDataURL(file)\n    reader.onloadend = () => {\n    console.log(reader);\n    //Base64转换成二进制\n    const dataURItoBlob=(dataURI)=> {\n        const byteString = atob(dataURI.split(',')[1])\n        const mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0]\n        const ab = new ArrayBuffer(byteString.length)\n        const ia = new Uint8Array(ab)\n        for (let i = 0; i < byteString.length; i++) {\n        ia[i] = byteString.charCodeAt(i)\n        }\n        return new Blob([ab], { type: mimeString })\n    }\n    const blob = dataURItoBlob(reader.result)\n    const form = new FormData();\n    form.append(\"file\" , blob);\n    const options = {\n    method: 'POST',\n    url: 'https://spoonacular-recipe-food-nutrition-v1.p.rapidapi.com/food/images/analyze',\n    headers: {\n        'content-type': 'multipart/form-data; boundary=---011000010111000001101001',\n        'x-rapidapi-host': 'spoonacular-recipe-food-nutrition-v1.p.rapidapi.com',\n        'x-rapidapi-key': 'ca34833afamsh5ac992bc1103a7fp14ff01jsne781a4ca7f2a'\n    },\n    data: form\n    };\n    axios.request(options).then(function (response) {\n        console.log(response.data);\n        this.saveFood(response.data)\n        // PubSub.publish('pictureMatch', {users: response.data})\n        // PubSub.publish('updateListState',{isLoading:false,users:response.data})\n    }).catch(function (error) {\n        console.error(error);\n    });\n}\n}\n\n  render() {\n    \n    return <div>\n        <div className=\"user-box\">\n              <div className=\"discount card\" style={{'--delay': '.4s'}}>\n              <input\n                  className='select-img-input'\n                  onChange={(e) => this.search(e)}\n                  type='file'\n                  name='fileSelect'\n                  accept='image/*'\n              />\n              <Result />\n              </div> \n              \n            </div>\n            \n    </div>;\n    \n  }\n}\n"]},"metadata":{},"sourceType":"module"}